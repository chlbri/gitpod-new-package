name: CI

on: [push, pull_request]

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    steps:
      - name: echo
        run: echo "Starting build..."

      # - name: Checkout repo
      #   uses: actions/checkout@v2

      # - uses: pnpm/action-setup@v2.2.2
      #   with:
      #     version: latest
      #     run_install: true

      # - name: Lint
      #   run: pnpm lint

      # - name: Test
      #   run: pnpm run test --ci --coverage --maxWorkers=2

      # - name: Build
      #   run: pnpm build

      - name: Commit
        uses: EndBug/add-and-commit@v9
        
  check-secret:
    name: Check NPM_TOKEN
    uses: ./.github/workflows/check-secret.yml
    secrets: 
      secret: ${{ secrets.NPM_TOKEN }}

  publish:
    name: Publish
    needs: [check-secret, build]
    if: needs.check-secret.outputs.defined == 'true'
    uses: ./.github/workflows/publish.yml
    secrets: 
      token: ${{ secrets.NPM_TOKEN }}
      
